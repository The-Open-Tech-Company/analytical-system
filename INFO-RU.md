# Аналитическая система - Подробная документация

**Репозиторий:** https://github.com/The-Open-Tech-Company/analytical-system  
**Лицензия:** Unlicense (Открытый исходный код)  
**Открытый исходный код:** Да

## Обзор

Аналитическая система - это комплексная платформа для биометрического анализа, предназначенная для распознавания, сравнения и анализа лиц и голосов. Система предоставляет продвинутые возможности для извлечения, сравнения и визуализации биометрических характеристик.

## Модуль анализа лиц

### Извлечение характеристик лица

Система использует MediaPipe Face Mesh для извлечения 468 лицевых ориентиров и анализирует следующие характеристики:

1. **Овал лица** - Внешний контур лица
2. **Форма головы** - Общий контур головы
3. **Глаза** - Контуры левого и правого глаза
4. **Брови** - Формы левой и правой брови
5. **Нос** - Спинка, кончик и контур носа
6. **Рот** - Внешний и внутренний контуры, верхняя и нижняя губы
7. **Скулы** - Области левой и правой скул
8. **Уши** - Контуры и детали левого и правого уха
9. **Подбородок** - Форма и контур подбородка
10. **Лоб** - Область лба
11. **Волосы** - Линия роста волос и области висков

### Определение пола

Несколько методов определения с приоритетом:

1. **Продвинутый детектор пола** (Ансамбль) - Комбинирует несколько моделей для максимальной точности
2. **DeepFace** - Использует модели ArcFace или VGG-Face
3. **OpenCV DNN** - Модели определения пола на основе Caffe
4. **Эвристический метод** - Геометрический анализ пропорций лица

### Оценка возраста

Методы:
- **DeepFace** - Оценка возраста на основе нейронных сетей
- **OpenCV DNN** - Модели возраста на основе Caffe
- **Эвристика** - Анализ пропорций лица и текстуры кожи

### Определение расы/этнической принадлежности

Методы:
- **Анализатор расы** - Определение на основе DeepFace/InsightFace
- **Эвристика** - Анализ геометрии лица и тона кожи

### Сравнение лиц

Система сравнения:
- Нормализует размеры и ориентации лиц
- Сравнивает отдельные характеристики со взвешенной оценкой
- Использует критические характеристики (глаза, нос, рот) с большим весом
- Предоставляет проценты совпадения для каждой характеристики
- Вычисляет общий показатель схожести

**Критические характеристики** (вес 60%):
- Левый глаз, Правый глаз
- Кончик носа, Спинка носа
- Внешний контур рта
- Овал лица
- Подбородок

**Другие характеристики** (вес 40%):
- Брови, Скулы, Уши, Лоб и др.

### База данных лиц

База данных на основе SQLite для хранения и поиска лиц:
- Хранение характеристик лица с метаданными (имя, год рождения, дополнительная информация)
- Поиск похожих лиц
- Обновление и удаление записей
- Функции экспорта/импорта

## Модуль анализа голоса

### Извлечение характеристик голоса

Извлекаемые характеристики:
- **Высота тона (F0)** - Основная частота с использованием PYIN и PIPTrack
- **MFCC** - Коэффициенты мел-частотного кепстра (13 коэффициентов)
- **Спектральный центроид** - Центр масс спектра
- **Частота пересечения нуля** - Частота пересечений нуля
- **Энергия RMS** - Среднеквадратичная энергия
- **Форманты** - Частоты формант F1 и F2
- **Темп речи** - Слогов в секунду

### Определение пола

Использует высоту тона, форманты и спектральные характеристики:
- **Мужские голоса**: 80-180 Гц (медиана ~120 Гц)
- **Женские голоса**: 150-300 Гц (медиана ~220 Гц)
- Порог: ~165 Гц для русского языка

### Определение языка

Два комбинированных метода:
1. **Акустический анализ** - MFCC, форманты, спектральные характеристики
2. **Распознавание речи** - API Google Speech Recognition

Поддерживаемые языки:
- Русский (основной)
- Английский
- Испанский
- Немецкий
- Французский
- Итальянский
- Польский
- Украинский

### Определение акцента

Анализирует паттерны формант и характеристики MFCC для определения:
- Носитель языка (без акцента)
- Русский акцент
- Английский акцент
- Другие акценты

### Определение эмоций

Определяет эмоции по характеристикам голоса:
- Радость/Возбуждение
- Грусть
- Страх/Тревога
- Гнев
- Нейтральное состояние

### Сравнение голосов

Сравнивает голоса используя:
- Схожесть высоты тона
- Косинусное сходство MFCC
- Сравнение формант
- Сравнение спектрального центроида
- Сравнение энергии и ZCR

## Технические детали

### Конвейер анализа лиц

1. **Загрузка изображения** - Несколько резервных методов (OpenCV, NumPy, PIL)
2. **Предобработка** - Улучшение CLAHE, регулировка яркости/контраста
3. **Детекция лица** - MediaPipe Face Detection (низкий порог для плохих изображений)
4. **Извлечение ориентиров** - MediaPipe Face Mesh (468 точек)
5. **Извлечение характеристик** - Интерполяция для увеличения плотности точек (в 30 раз)
6. **Нормализация** - Нормализация размера и ориентации
7. **Сравнение** - Точечное и метрическое сравнение

### Конвейер анализа голоса

1. **Загрузка аудио** - Librosa/SoundFile с конвертацией формата
2. **Фильтрация шума** - Медианный фильтр для щелчков, высокочастотный фильтр для скрипов
3. **Извлечение характеристик** - Высота тона, MFCC, спектральные характеристики
4. **Анализ** - Определение пола, языка, акцента, эмоций
5. **Сравнение** - Сравнение векторов характеристик

### Оптимизации производительности

- Кэширование инициализаций моделей
- Эффективные операции NumPy
- Параллельная обработка где возможно
- Эффективная обработка изображений по памяти
- Оптимизированные запросы к базе данных

## Возможности GUI

### Окно анализа лица
- Загрузка и отображение изображений
- Результаты анализа в реальном времени
- Интерактивная визуализация
- Интеграция с базой данных

### Окно сравнения лиц
- Отображение изображений рядом
- Детальные результаты сравнения
- Режимы визуализации (общий/детальный)
- Элементы управления поворотом изображений
- Функции экспорта

### Окно анализа голоса
- Загрузка аудиофайлов
- Запись в реальном времени
- Отображение результатов анализа
- Визуализация формы волны
- Функции экспорта

### Окно сравнения голосов
- Загрузка двух аудио
- Результаты сравнения
- Анализ по характеристикам
- Показатели схожести

## Схема базы данных

### Таблица Faces
- `id` - Первичный ключ
- `full_name` - Имя человека
- `birth_year` - Год рождения (опционально)
- `additional_info` - Дополнительная информация (опционально)
- `face_features` - Сериализованные характеристики лица (BLOB)
- `created_at` - Временная метка

## Форматы файлов

### Поддерживаемые форматы изображений
- JPEG/JPG
- PNG
- BMP
- GIF
- WebP

### Поддерживаемые форматы аудио
- WAV
- MP3
- FLAC
- OGG
- M4A

## Обработка ошибок

Система включает комплексную обработку ошибок:
- Валидация файлов
- Определение формата изображения
- Конвертация формата аудио
- Резервные варианты инициализации моделей
- Плавная деградация при недоступности опциональных модулей

## Конфигурация

Настройки можно изменить в `settings_window.py`:
- Пороги детекции лиц
- Чувствительность сравнения
- Опции визуализации
- Настройки базы данных

## Зависимости

См. `requirements.txt` для полного списка. Ключевые зависимости:
- opencv-contrib-python
- mediapipe
- numpy
- tensorflow
- deepface
- librosa
- soundfile
- speechrecognition

## Лицензия

Проект распространяется в общественном достоянии под лицензией Unlicense. Вы можете свободно использовать, изменять, распространять и продавать это программное обеспечение для любых целей, коммерческих или некоммерческих.

## Вклад в проект

Вклад приветствуется! Пожалуйста, убедитесь, что код следует существующему стилю и включает соответствующую обработку ошибок.

## Поддержка

По вопросам, проблемам или вкладу, пожалуйста, посетите:
https://github.com/The-Open-Tech-Company/analytical-system

