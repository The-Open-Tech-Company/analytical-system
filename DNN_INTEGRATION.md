# Интеграция OpenCV DNN для анализа пола и возраста

## Описание

В проект интегрирован модуль `gender_age_dnn.py`, который использует OpenCV DNN с предобученными моделями для более точного определения пола и возраста по лицам на фотографиях.

## Преимущества

- **Высокая точность**: Использует предобученные модели глубокого обучения вместо эвристических методов
- **Совместимость**: Не требует дополнительных зависимостей (использует уже установленный OpenCV)
- **Автоматическая загрузка**: Модели загружаются автоматически при первом использовании
- **Fallback**: При недоступности DNN автоматически используется эвристический метод

## Структура

### Новые файлы:
- `gender_age_dnn.py` - модуль для работы с OpenCV DNN моделями

### Измененные файлы:
- `face_analyzer.py` - интегрирован OpenCV DNN для определения пола и возраста

## Как это работает

1. При инициализации `FaceAnalyzer` автоматически создается экземпляр `GenderAgeDNN`
2. При первом использовании модели загружаются из репозитория OpenCV (если их нет локально)
3. Модели сохраняются в папке `models/` для последующего использования
4. При анализе лица:
   - Если DNN доступен → используется для определения пола и возраста
   - Если DNN недоступен → используется эвристический метод (как раньше)
   - Раса всегда определяется эвристическим методом (модели для расы нет в стандартном наборе)

## Модели

Используются предобученные модели из репозитория OpenCV:
- **Модель пола**: обучена на датасете Adience
- **Модель возраста**: обучена на датасете Adience, определяет возрастные категории:
  - (0-2), (4-6), (8-12), (15-20), (25-32), (38-43), (48-53), (60-100)

## Использование

Использование остается прежним - никаких изменений в API:

```python
from face_analyzer import FaceAnalyzer

analyzer = FaceAnalyzer()
features = analyzer.extract_face_features("image.jpg")

# Результаты содержат:
# - features['gender'] - пол (определен через DNN)
# - features['age'] - возраст (определен через DNN)
# - features['race'] - раса (определена эвристическим методом)
# - features['gender_confidence'] - уверенность в определении пола
# - features['age_confidence'] - уверенность в определении возраста
# - features['race_confidence'] - уверенность в определении расы
```

## Папка models/

При первом запуске создается папка `models/` со следующими файлами:
- `deploy_gender.prototxt` - конфигурация модели пола
- `gender_net.caffemodel` - веса модели пола
- `deploy_age.prototxt` - конфигурация модели возраста
- `age_net.caffemodel` - веса модели возраста

Эти файлы загружаются автоматически и используются для последующих запусков.

## Обработка ошибок

- Если модели не удалось загрузить → используется эвристический метод
- Если DNN недоступен → используется эвристический метод
- Все ошибки логируются, но не прерывают работу программы

## Примечания

- Первый запуск может занять время из-за загрузки моделей (~10-20 МБ)
- Модели требуют интернет-соединения для первоначальной загрузки
- После загрузки модели работают офлайн
- Для определения расы по-прежнему используется эвристический метод (стандартные модели OpenCV не включают определение расы)

